[1mdiff --git a/c_coding/kernel_module/netlink/mynetlink/senderAndReceiver/netlink_kernel.c b/c_coding/kernel_module/netlink/mynetlink/senderAndReceiver/netlink_kernel.c[m
[1mindex 7233551..ea96579 100755[m
[1m--- a/c_coding/kernel_module/netlink/mynetlink/senderAndReceiver/netlink_kernel.c[m
[1m+++ b/c_coding/kernel_module/netlink/mynetlink/senderAndReceiver/netlink_kernel.c[m
[36m@@ -15,6 +15,10 @@[m [mspace-via-netlink-in-c[m
 #include <linux/netlink.h>[m
 #include <linux/skbuff.h>[m
 [m
[32m+[m[32m//#include <linux/init.h>[m
[32m+[m[32m//#include <linux/ip.h>[m
[32m+[m
[32m+[m
 #ifndef NETLINK_EXAMPLE[m
 #define NETLINK_EXAMPLE 17[m
 #endif[m
[36m@@ -22,22 +26,58 @@[m [mspace-via-netlink-in-c[m
 struct sock *nl_sk = NULL;[m
 #define MYMGRP 1[m
 [m
[31m-void send_to_user(void) [m
[32m+[m
[32m+[m[32m#if 0[m
[32m+[m[32mstatic void nl_data_ready(struct sk_buff *__skb)[m
[32m+[m[32m{[m
[32m+[m[32m    struct sk_buff *skb;[m
[32m+[m[32m    struct nlmsghdr *nlh = NULL;[m
[32m+[m	[32mwhile((skb = skb_get(__skb)) != NULL) {[m
[32m+[m		[32mnlh = (struct nlmsghdr *)skb->data;[m
[32m+[m		[32m//nlh = nlmsg_hdr(skb);[m
[32m+[m		[32mprintk("%s: received netlink message payload: %s \n", __FUNCTION__, (char*)NLMSG_DATA(nlh) );[m
[32m+[m		[32mkfree_skb(skb);[m
[32m+[m		[32mbreak;[m
[32m+[m[32m    }[m
[32m+[m[32m    printk("recvied finished!\n");[m
[32m+[m[32m}[m
[32m+[m[32m#endif[m
[32m+[m
[32m+[m
[32m+[m[32mvoid parse_message(struct sk_buff *__skb, char *message){[m
[32m+[m
[32m+[m	[32mstruct sk_buff *skb;[m
[32m+[m	[32mstruct nlmsghdr *nlh = NULL;[m
[32m+[m	[32mwhile((skb = skb_get(__skb)) != NULL) {[m
[32m+[m	[41m   [m	[32mnlh = (struct nlmsghdr *)skb->data;[m
[32m+[m	[41m   [m	[32m//nlh = nlmsg_hdr(skb);[m
[32m+[m	[41m   [m	[32mprintk("%s: received netlink message payload: %s \n", __FUNCTION__, (char*)NLMSG_DATA(nlh) );[m
[32m+[m		[32m//strcpy(message, (char*)NLMSG_DATA(nlh));[m
[32m+[m	[41m   [m	[32mkfree_skb(skb);[m
[32m+[m	[41m   [m	[32mbreak;[m
[32m+[m	[32m}[m
[32m+[m	[32mprintk("recvied finished!\n");[m
[32m+[m[32m}[m
[32m+[m
[32m+[m
[32m+[m[32mvoid send_to_user(struct sk_buff *__skb)[m[41m [m
 {[m
     struct sk_buff *skb = NULL;[m
     struct nlmsghdr *nlh;[m
 	int ret = 0;[m
 	char *message = "Hello from the kernel!";[m
[32m+[m
 	int msg_size = strlen(message) + 1;[m
 [m
 	printk("Eneter the send_to_user!\n");[m
[32m+[m
[32m+[m[41m	[m
 	[m
 	/*¿ª±ÙÒ»¸öĞÂµÄÌ×½Ó×Ö»º´æ*/[m
 	skb = nlmsg_new(NLMSG_ALIGN(msg_size + 1), GFP_KERNEL);	[m
 	//skb = nlmsg_new(NLMSG_DEFAULT_SIZE, GFP_KERNEL);[m
 	if(!skb){[m
 		printk("Allocation failure!\n");[m
[31m-		return -1;[m
 	}[m
 	/*ÌîĞ´Êı¾İ±¨Ïà¹ØĞÅÏ¢*/[m
 	nlh = nlmsg_put(skb, 0, 1, NLMSG_DONE, msg_size + 1, 0);/*must*/[m
[36m@@ -56,15 +96,13 @@[m [mvoid send_to_user(void)[m
 		printk("Send successfully! The data is:\033[32m[%s]\033[0m\n", NLMSG_DATA(nlh));[m
 		[m
 	}[m
[31m-	//sock_release(nl_sk->sk_socket);  	[m
 }[m
 [m
 struct netlink_kernel_cfg cfg = {[m
     .input = send_to_user,[m
[31m-		[m
 };[m
 [m
[31m-static int __init testnetlink_init(void)[m
[32m+[m[32mstatic int __init  testnetlink_init(void)[m
 {[m
 [m
 	printk(KERN_INFO "insmod the kernel module netlink_kernel_module.ko !\n");[m
[36m@@ -73,7 +111,7 @@[m [mstatic int __init testnetlink_init(void)[m
 	[m
 	return 0;[m
 }[m
[31m-static void __exit testnetlink_exit(void)[m
[32m+[m[32mstatic void __exit  testnetlink_exit(void)[m
 {[m
 	printk(KERN_INFO "remove the kernel module netlink_kernel_module.ko !\n");[m
 	netlink_kernel_release(nl_sk);[m
[1mdiff --git a/c_coding/kernel_module/proc/myproc/myproc_rw/readme b/c_coding/kernel_module/proc/myproc/myproc_rw/readme[m
[1mindex adde5ba..e4d261f 100755[m
[1m--- a/c_coding/kernel_module/proc/myproc/myproc_rw/readme[m
[1m+++ b/c_coding/kernel_module/proc/myproc/myproc_rw/readme[m
[36m@@ -1,9 +1,9 @@[m
 æœ¬æ–‡ä»¶å¤¹å†…å«æœ‰ä»¥ä¸‹æºæ–‡ä»¶ï¼š[m
 .[m
[31m-â”œâ”€â”€ hunter.c        	#ç”¨æˆ·ç©ºé—´å®ˆæŠ¤è¿›ç¨‹â€”â€”è·å–å†…æ ¸å†™å…¥ç”¨æˆ·ç©ºé—´çš„æ•°æ®[m
[32m+[m[32mâ”œâ”€â”€ hunter.c        		#ç”¨æˆ·ç©ºé—´å®ˆæŠ¤è¿›ç¨‹â€”â€”è·å–å†…æ ¸å†™å…¥ç”¨æˆ·ç©ºé—´çš„æ•°æ®[m
 â”œâ”€â”€ hunter.h			#[m
 â”œâ”€â”€ Makefile			#ç¼–è¯‘è§„åˆ™ï¼šå¯ä»¥ç¼–è¯‘å‡ºå†…æ ¸æ¨¡å—ä»¥åŠç”¨æˆ·ç©ºé—´ç¨‹åº[m
[31m-â”œâ”€â”€ proc_kernel_lib.c	#å†…æ ¸æ¨¡å—â€”â€”å®ç°äº†å‘ç”¨æˆ·ç©ºé—´å†™æ•°æ®çš„æ¥å£[m
[32m+[m[32mâ”œâ”€â”€ proc_kernel_lib.c		#å†…æ ¸æ¨¡å—â€”â€”å®ç°äº†å‘ç”¨æˆ·ç©ºé—´å†™æ•°æ®çš„æ¥å£[m
 â”œâ”€â”€ proc_lib_call.c		#å†…æ ¸æ¨¡å—â€”â€”ç”¨ä»¥è°ƒç”¨proc_kernel_libå†…æ ¸æ¨¡å—ä¸­çš„æ¥å£å‘ç”¨æˆ·ç©ºé—´å†™æ•°æ®[m
 â””â”€â”€ readme				#æœ¬æ–‡ä»¶[m
 [m
[36m@@ -24,7 +24,7 @@[m
 		$sudo insmod proc_kernel_lib.ko[m
 [m
 	(4)è¿è¡Œç”¨æˆ·ç©ºé—´å®ˆæŠ¤è¿›ç¨‹[m
[31m-		$./message_hunter[m
[32m+[m		[32m$sudo ./message_hunter[m
 		æ­¤è¿›ç¨‹è¿è¡Œååœ¨/procç›®å½•ä¸‹åˆ›å»ºä¸€ä»½å±äºè¯¥è¿›ç¨‹çš„PIDæ–‡ä»¶/proc/message_hunter[m
 		æŸ¥çœ‹è¯¥PIDæ–‡ä»¶ï¼š[m
 		$cat /proc/message_hunter [m
