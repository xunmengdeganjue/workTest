From a79a79246d23f9a5a5c8fb58d68c2ec5d7fdc641 Mon Sep 17 00:00:00 2001
From: Navneet Barwal <navneet.barwal@iotina.io>
Date: Sun, 14 Aug 2016 15:48:15 +0530
Subject: [PATCH 3/6] changes for captive portal

---
 .../skysoft/spectrum-wifi/files/clear_ssid_vlan.sh |   1 +
 .../www/module/Root/Spectram_WIFI.html             | 145 +++++++++++++++--
 .../skysoft/spectrum-wifi/files/clear_ssid_vlan.sh |   1 +
 .../network/config/netifd/files/etc/init.d/network |   3 +
 .../skysoft/skysoft_web_admin/cgi/function/wlan.c  | 181 ++++++++++++++++++++-
 .../skysoft_web_admin/cgi/include/uci_cfg.h        | 159 ++++++++++++++++++
 .../skysoft/spectrum-wifi/files/clear_ssid_vlan.sh |  75 +++++++++
 .../wlan_10_4/net/qca-wifi-10.4/files/qcawifi.sh   |  68 +++++++-
 8 files changed, 619 insertions(+), 14 deletions(-)
 create mode 120000 base/software/askey/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh
 create mode 120000 base/software/charter/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh
 create mode 100755 base/software/common/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh

diff --git a/base/software/askey/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh b/base/software/askey/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh
new file mode 120000
index 0000000..03a9e06
--- /dev/null
+++ b/base/software/askey/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh
@@ -0,0 +1 @@
+../../../../../../common/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh
\ No newline at end of file
diff --git a/base/software/charter/qsdk/package/skysoft/skysoft_web_admin/www/module/Root/Spectram_WIFI.html b/base/software/charter/qsdk/package/skysoft/skysoft_web_admin/www/module/Root/Spectram_WIFI.html
index eb09f80..5adca77 100644
--- a/base/software/charter/qsdk/package/skysoft/skysoft_web_admin/www/module/Root/Spectram_WIFI.html
+++ b/base/software/charter/qsdk/package/skysoft/skysoft_web_admin/www/module/Root/Spectram_WIFI.html
@@ -90,7 +90,7 @@
         <caption class="info-title">VLAN</caption>
         <tbody class="info-tbody">
         <tr>
-            <td class="info-item">Enable Upstream Vlan1</td>
+            <td class="info-item">Enable Upstream Vlan</td>
             <td class="info-content">
                 <input id="enableVlan_1" name="enableVlan" value="1" type="radio">
                 <label for="enableVlan_1">Yes</label>
@@ -137,7 +137,7 @@
         <tbody class="info-tbody">
 
         <tr>
-            <td class="info-item">GRE Mode1</td>
+            <td class="info-item">GRE Mode</td>
             <td class="info-content">
                 <input id="greMode_1" name="greMode" value="1" type="radio">
                 <label for="greMode_1">IPv4</label>
@@ -147,22 +147,37 @@
             </td>
         </tr>
         <tr class="gre_remote4-setting">
-		<td class="info-item"><label for="remoteIp">Primary EP IPv4</label></td>
+		<td class="info-item"><label for="remoteIp">Primary EP IPv4 (secured)</label></td>
         	<td class="info-content"><input id="remoteIp" type="text"/></td>
 	</tr>
 	<tr  class="gre_remotesec4-setting">
-                <td class="info-item"><label for="remoteSecIp">Secondary EP IPv4</label></td>
+                <td class="info-item"><label for="remoteSecIp">Secondary EP IPv4 (secured)</label></td>
        	        <td class="info-content"><input id="remoteSecIp" type="text"/></td>
 	</tr>
         <tr class="gre_remote6-setting">
-                <td class="info-item"><label for="remoteIp6">Primary EP IPv6</label></td>
+                <td class="info-item"><label for="remoteIp6">Primary EP IPv6 (secured)</label></td>
        	        <td class="info-content"><input id="remoteIp6" type="text"/></td>
         </tr>
         <tr class="gre_remotesec6-setting">
-                <td class="info-item"><label for="remoteSecIp6">Secondary EP IPv6</label></td>
+                <td class="info-item"><label for="remoteSecIp6">Secondary EP IPv6 (secured)</label></td>
        	        <td class="info-content"><input id="remoteSecIp6" type="text"/></td>
         </tr>
-
+        <tr class="gre_remote4-setting">
+		<td class="info-item"><label for="remoteIpCaptive">Primary EP IPv4 (captive)</label></td>
+        	<td class="info-content"><input id="remoteIpCaptive" type="text"/></td>
+	</tr>
+	<tr  class="gre_remotesec4-setting">
+                <td class="info-item"><label for="remoteSecIpCaptive">Secondary EP IPv4 (captive)</label></td>
+       	        <td class="info-content"><input id="remoteSecIpCaptive" type="text"/></td>
+	</tr>
+        <tr class="gre_remote6-setting">
+                <td class="info-item"><label for="remoteIp6Captive">Primary EP IPv6 (captive)</label></td>
+       	        <td class="info-content"><input id="remoteIp6Captive" type="text"/></td>
+        </tr>
+        <tr class="gre_remotesec6-setting">
+                <td class="info-item"><label for="remoteSecIp6Captive">Secondary EP IPv6 (captive)</label></td>
+       	        <td class="info-content"><input id="remoteSecIp6Captive" type="text"/></td>
+        </tr>
             <tr>
                 <td class="info-item"><label for="keepaliveInterval">Keepalive Interval(secs)</label></td>
                 <td class="info-content"><input id="keepaliveInterval" type="text"/></td>
@@ -211,6 +226,22 @@
         <caption class="info-title">2.4GHz WiFi Setting</caption>
         <tbody class="info-tbody">
         <tr>
+            <td class="info-item">Enable Spectrum WiFi Captive Portal</td>
+            <td class="info-content">
+                <input id="enableWifiCaptive_1" name="enableWifiCaptive" value="1" type="radio">
+                <label for="enableWifiCaptive_1">Yes</label>
+                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+                <input id="enableWifiCaptive_0" name="enableWifiCaptive" value="0" type="radio">
+                <label for="enableWifiCaptive_0">No</label>
+            </td>
+        </tr>
+        <tr>
+            <td class="info-item"><label for="ssidCaptive">SSID</label></td>
+            <td class="info-content"><input id="ssidCaptive" type="text"/></td>
+        </tr>
+
+
+        <tr>
             <td class="info-item">Enable Spectrum WiFi</td>
             <td class="info-content">
                 <input id="enableWifi_1" name="enableWifi" value="1" type="radio">
@@ -271,6 +302,22 @@
         <caption class="info-title">5GHz WiFi Setting</caption>
         <tbody class="info-tbody">
         <tr>
+            <td class="info-item">Enable Captive Spectrum WiFi</td>
+            <td class="info-content">
+                <input id="enableWifi5g_1_Captive" name="enableWifi5gCaptive" value="1" type="radio">
+                <label for="enableWifi5g_1_Captive">Yes</label>
+                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+                <input id="enableWifi5g_0_Captive" name="enableWifi5gCaptive" value="0" type="radio">
+                <label for="enableWifi_0_Captive">No</label>
+            </td>
+        </tr>
+        <tr>
+            <td class="info-item"><label for="ssid5gCaptive">Captive SSID</label></td>
+            <td class="info-content"><input id="ssid5gCaptive" type="text"/></td>
+        </tr>
+
+
+        <tr>
             <td class="info-item">Enable Spectrum WiFi</td>
             <td class="info-content">
                 <input id="enableWifi5g_1" name="enableWifi5g" value="1" type="radio">
@@ -284,6 +331,7 @@
             <td class="info-item"><label for="ssid5g">SSID</label></td>
             <td class="info-content"><input id="ssid5g" type="text"/></td>
         </tr>
+
         <!--<tr>-->
             <!--<td class="info-item"><label for="RadiusServer5g">Server</label></td>-->
             <!--<td class="info-content"><input id="RadiusServer5g" type="text"/></td>-->
@@ -341,6 +389,11 @@ var $_up_dscp=$("#up_dscp"),
     $_remoteSecIp=$("#remoteSecIp"),
     $_remoteIp6=$("#remoteIp6"),
     $_remoteSecIp6=$("#remoteSecIp6"),
+
+    $_remoteIpCaptive=$("#remoteIpCaptive"),
+    $_remoteSecIpCaptive=$("#remoteSecIpCaptive"),
+    $_remoteIp6Captive=$("#remoteIp6Captive"),
+    $_remoteSecIp6Captive=$("#remoteSecIp6Captive"),
  
     $_keepaliveInterval=$("#keepaliveInterval"),
     $_keepaliveThreshold=$("#keepaliveThreshold"),
@@ -355,6 +408,8 @@ var $_up_dscp=$("#up_dscp"),
     $_ip6_gre=$("#ip6_gre"),
 
     $_ssid=$("#ssid"),
+    $_ssidCaptive=$("#ssidCaptive"),
+
 //    $_RadiusServer=$("#RadiusServer"),
 //    $_RadiusPort=$("#RadiusPort"),
     $_AuthServer=$("#AuthServer"),
@@ -365,6 +420,8 @@ var $_up_dscp=$("#up_dscp"),
     $_AcctSecret=$("#AcctSecret"),
 
     $_ssid5g=$("#ssid5g"),
+    $_ssid5gCaptive=$("#ssid5gCaptive"),
+
 //    $_RadiusServer5g=$("#RadiusServer5g"),
 //    $_RadiusPort5g=$("#RadiusPort5g"),
     $_AuthServer5g=$("#AuthServer5g"),
@@ -407,6 +464,11 @@ CurPage.Data=(function($,UI){
                 $_remoteIp6.val(data["peeraddr6"]);
                 $_remoteSecIp6.val(data["peersecaddr6"]);
 
+                $_remoteIpCaptive.val(data["peeraddrcaptive"]);
+                $_remoteSecIpCaptive.val(data["peersecaddrcaptive"]);
+                $_remoteIp6Captive.val(data["peeraddr6captive"]);
+                $_remoteSecIp6Captive.val(data["peersecaddr6captive"]);
+
 
 		$_keepaliveInterval.val(data["kaInterval"]);
 		$_keepaliveThreshold.val(data["kaThreshold"]);
@@ -416,7 +478,11 @@ CurPage.Data=(function($,UI){
                 $_bridageNetmask.val(data["bridge_ip_netmask"]);
                 //                2.4g
                 InputUtils.checkBoxByVal($("input[name='enableWifi']"),data["WLANIF2G_enable_spectrumwifi"]);
+		InputUtils.checkBoxByVal($("input[name='enableWifiCaptive']"),data["WLANIF2G_enable_spectrumwifi_captive"]);
+
                 $_ssid.val(data["WLANIF2G_spectrumwifi_ssid"]);
+                $_ssidCaptive.val(data["WLANIF2G_spectrumwifi_ssid_captive"]);
+
 //                $_RadiusServer.val(data["WLANIF2G_server"]);
 //                $_RadiusPort.val(data["WLANIF2G_server_port"]);
                 $_AuthServer.val(data["WLANIF2G_auth_server"]);
@@ -427,7 +493,11 @@ CurPage.Data=(function($,UI){
                 $_AcctSecret.val(data["WLANIF2G_acct_secret"]);
 //                5g
                 InputUtils.checkBoxByVal($("input[name='enableWifi5g']"),data["WLANIF5G_enable_spectrumwifi"]);
+                InputUtils.checkBoxByVal($("input[name='enableWifi5gCaptive']"),data["WLANIF5G_enable_spectrumwifi_captive"]);
+
                 $_ssid5g.val(data["WLANIF5G_spectrumwifi_ssid"]);
+                $_ssid5gCaptive.val(data["WLANIF5G_spectrumwifi_ssid_captive"]);
+
 //                $_RadiusServer5g.val(data["WLANIF5G_server"]);
 //                $_RadiusPort5g.val(data["WLANIF5G_server_port"]);
                 $_AuthServer5g.val(data["WLANIF5G_auth_server"]);
@@ -444,7 +514,11 @@ CurPage.Data=(function($,UI){
                 $_enableBandSteer_radio=$("input[name='enableBandSteer']");
 
                 $_enableWifi_radio=$("input[name='enableWifi']");
+                $_enableWifiCaptive_radio=$("input[name='enableWifiCaptive']");
+
                 $_enableWifi5g_radio=$("input[name='enableWifi5g']");
+                $_enableWifi5g_captive_radio=$("input[name='enableWifi5gCaptive']");
+
             }
         });
         //获取lan口信息，以计算本页面是否属于和lan口同一网段
@@ -634,14 +708,38 @@ CurPage.Event=(function($,UI){
 		}
             },
             remoteIp6:function(ele){
-                if($_enableVlan_radio.filter(":checked").val()==='1'){
+                if($_greMode_radio.filter(":checked").val()==='1'){
                     return true;
                 }else{
                     return true;
                 }
             },
             remoteSecIp6:function(ele){
-                if($_enableVlan_radio.filter(":checked").val()==='1'){
+                if($_greMode_radio.filter(":checked").val()==='1'){
+                    return true;
+                }else{
+                    return true;
+                }
+           },
+            remoteIpCaptive:function(ele){
+                if($_greMode_radio.filter(":checked").val()=='1'){
+                	return CheckUtils.isIP(ele);
+		}
+            },
+            remoteSecIpCaptive:function(ele){
+                if($_greMode_radio.filter(":checked").val()=='1'){
+                	return CheckUtils.isIP(ele);
+		}
+            },
+            remoteIp6Captive:function(ele){
+                if($_greMode_radio.filter(":checked").val()==='1'){
+                    return true;
+                }else{
+                    return true;
+                }
+            },
+            remoteSecIp6Captive:function(ele){
+                if($_greMode_radio.filter(":checked").val()==='1'){
                     return true;
                 }else{
                     return true;
@@ -697,6 +795,14 @@ CurPage.Event=(function($,UI){
                 return result;
 
             },
+            ssidCaptive: function (ele) {
+                var result=CheckUtils.isEmpty(ele);
+                if(result==true){
+                    result= CheckUtils.isSSID(ele);
+                }
+                return result;
+
+            },
             AuthServer: function (ele) {
                 return CheckUtils.isIP(ele)
 
@@ -720,6 +826,13 @@ CurPage.Event=(function($,UI){
                 }
                 return result;
             },
+            ssid5gCaptive: function (ele) {
+                var result=CheckUtils.isEmpty(ele);
+                if(result==true){
+                    result= CheckUtils.isSSID(ele);
+                }
+                return result;
+            },
             AuthServer5g: function (ele) {
                 return CheckUtils.isIP(ele)
 
@@ -788,7 +901,9 @@ CurPage.Event=(function($,UI){
                 "bridge_ip_netmask":$_bridageNetmask.val(),
                 //2.4g
                 "WLANIF2G_enable_spectrumwifi":parseInt($("input[name='enableWifi']:checked").val()),
+                "WLANIF2G_enable_spectrumwifi_captive":parseInt($("input[name='enableWifiCaptive']:checked").val()),
                 "WLANIF2G_spectrumwifi_ssid":$_ssid.val(),
+                "WLANIF2G_spectrumwifi_ssid_captive":$_ssidCaptive.val(),
 //                "WLANIF2G_server":$_RadiusServer.val(),
 //                "WLANIF2G_server_port":$_RadiusPort.val(),
                 "WLANIF2G_auth_server":$_AuthServer.val(),
@@ -799,7 +914,11 @@ CurPage.Event=(function($,UI){
                 "WLANIF2G_acct_secret":$("#AcctSecret").val(),
                 //5g
                 "WLANIF5G_enable_spectrumwifi":parseInt($("input[name='enableWifi5g']:checked").val()),
+                "WLANIF5G_enable_spectrumwifi_captive":parseInt($("input[name='enableWifi5gCaptive']:checked").val()),
+
                 "WLANIF5G_spectrumwifi_ssid":$_ssid5g.val(),
+                "WLANIF5G_spectrumwifi_ssid_captive":$_ssid5gCaptive.val(),
+
 //                "WLANIF5G_server":$_RadiusServer5g.val(),
 //                "WLANIF5G_server_port":$_RadiusPort5g.val(),
                 "WLANIF5G_auth_server":$_AuthServer5g.val(),
@@ -821,12 +940,18 @@ CurPage.Event=(function($,UI){
             if(reqData["gre_mode"]==1){
                 reqData["peeraddr"]=$_remoteIp.val();
                 reqData["peersecaddr"]=$_remoteSecIp.val();
+
+                reqData["peeraddrcaptive"]=$_remoteIpCaptive.val();
+                reqData["peersecaddrcaptive"]=$_remoteSecIpCaptive.val();
+
             }
             if(reqData["gre_mode"]==0){
                 reqData["peeraddr6"]=$_remoteIp6.val();
                 reqData["peersecaddr6"]=$_remoteSecIp6.val();
-            }
 
+                reqData["peeraddr6captive"]=$_remoteIp6Captive.val();
+                reqData["peersecaddr6captive"]=$_remoteSecIp6Captive.val();
+            }
 
             Ajax.SetJsonData({
                 path: 'SetSpectrumWiFi',
diff --git a/base/software/charter/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh b/base/software/charter/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh
new file mode 120000
index 0000000..03a9e06
--- /dev/null
+++ b/base/software/charter/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh
@@ -0,0 +1 @@
+../../../../../../common/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh
\ No newline at end of file
diff --git a/base/software/common/qsdk/package/network/config/netifd/files/etc/init.d/network b/base/software/common/qsdk/package/network/config/netifd/files/etc/init.d/network
index f3a2016..b5e51d7 100755
--- a/base/software/common/qsdk/package/network/config/netifd/files/etc/init.d/network
+++ b/base/software/common/qsdk/package/network/config/netifd/files/etc/init.d/network
@@ -38,12 +38,14 @@ reload_service() {
 	ubus call network reload
 	/sbin/wifi reload_legacy
 	/etc/init.d/ssid_vlan.sh reload
+	/etc/init.d/clear_ssid_vlan.sh reload
 	/etc/init.d/check_del_spectrum_rule restore
 }
 
 stop_service() {
 	/etc/init.d/check_del_spectrum_rule check
 	/etc/init.d/ssid_vlan.sh stop
+	/etc/init.d/clear_ssid_vlan.sh stop
 	/sbin/wifi down
 }
 
@@ -67,6 +69,7 @@ service_running() {
 	killall netscan
 	netscan >/dev/null 2>&1
 	/etc/init.d/ssid_vlan.sh reload
+	/etc/init.d/clear_ssid_vlan.sh reload
 	/etc/init.d/check_del_spectrum_rule restore
         
 	/etc/init.d/8021x restart
diff --git a/base/software/common/qsdk/package/skysoft/skysoft_web_admin/cgi/function/wlan.c b/base/software/common/qsdk/package/skysoft/skysoft_web_admin/cgi/function/wlan.c
index f1990c3..ba7923a 100755
--- a/base/software/common/qsdk/package/skysoft/skysoft_web_admin/cgi/function/wlan.c
+++ b/base/software/common/qsdk/package/skysoft/skysoft_web_admin/cgi/function/wlan.c
@@ -14068,6 +14068,24 @@ int getspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 			strcpy(tmp_char, "");
 		}
 		json_object_object_add(obj, "peersecaddr", json_object_new_string(tmp_char));
+
+		//captive
+		ret = do_uci_get(SPEC_KA_PRI_ADDR_CAPTIVE , tmp_char);
+
+		if(ret != 0) {
+			cgi_err("get SPEC remote ipaddr captive err\n");
+			strcpy(tmp_char, "");
+		}	
+		json_object_object_add(obj, "peeraddrcaptive", json_object_new_string(tmp_char));
+
+		ret = do_uci_get(SPEC_KA_SEC_ADDR_CAPTIVE , tmp_char);
+
+		if(ret != 0) {
+			cgi_err("get SPEC remote secondary ipaddr captive err\n");
+			strcpy(tmp_char, "");
+		}
+		json_object_object_add(obj, "peersecaddrcaptive", json_object_new_string(tmp_char));
+
 	}
 	else {
 		ret = do_uci_get(SPEC_KA_PRI_ADDR , tmp_char);
@@ -14085,6 +14103,26 @@ int getspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 			strcpy(tmp_char, "");
 		}
 		json_object_object_add(obj, "peersecaddr6", json_object_new_string(tmp_char));
+
+
+		//captive
+		ret = do_uci_get(SPEC_KA_PRI_ADDR_CAPTIVE , tmp_char);
+
+		if(ret != 0) {
+			cgi_err("get SPEC remote ipaddr captive err\n");
+			strcpy(tmp_char, "");
+		}
+		json_object_object_add(obj, "peeraddr6captive", json_object_new_string(tmp_char));
+
+		ret = do_uci_get(SPEC_KA_SEC_ADDR_CAPTIVE , tmp_char);
+
+		if(ret != 0) {
+			cgi_err("get SPEC remote secondary ipaddr captive err\n");
+			strcpy(tmp_char, "");
+		}
+		json_object_object_add(obj, "peersecaddr6captive", json_object_new_string(tmp_char));
+
+
 	}
 
 	ret = do_uci_get(SPEC_BRIDGE_IP, tmp_char);
@@ -14101,6 +14139,7 @@ int getspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 	}
 	json_object_object_add(obj, "bridge_ip_netmask", json_object_new_string(tmp_char));
 
+
 	ret = do_uci_get(LBD_CONFIG_ENABLE , tmp_char);
 	if(ret != 0) {
 		cgi_err("get spec band steer enable err\n");
@@ -14133,13 +14172,33 @@ int getspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 	}
 	json_object_object_add(obj, "kaRevert", json_object_new_string(tmp_char));
 
+
+//clear
+	ret = do_uci_get(WIFI13_ATHENABLE, tmp_char);
+	if(ret != 0) {
+		cgi_err("get wlanif 2g athenable captive err\n");
+		strcpy(tmp_char, "");
+	}
+
+	json_object_object_add(obj, "WLANIF2G_enable_spectrumwifi_captive", json_object_new_int(atoi(tmp_char)));
+
+	ret = do_uci_get(WIFI13_SSID, tmp_char);
+	if(ret != 0) {
+		cgi_err("get wlanif 2g ssid captive err\n");
+		strcpy(tmp_char, "");
+	}
+	json_object_object_add(obj, "WLANIF2G_spectrumwifi_ssid_captive", json_object_new_string(tmp_char));
+
+
 	ret = do_uci_get(WIFI12_ATHENABLE, tmp_char);
 	if(ret != 0) {
 		cgi_err("get wlanif 2g athenable err\n");
 		strcpy(tmp_char, "");
 	}
+
 	json_object_object_add(obj, "WLANIF2G_enable_spectrumwifi", json_object_new_int(atoi(tmp_char)));
 
+
 	ret = do_uci_get(WIFI12_SSID, tmp_char);
 	if(ret != 0) {
 		cgi_err("get wlanif 2g ssid err\n");
@@ -14189,6 +14248,8 @@ int getspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 	}
 	json_object_object_add(obj, "WLANIF2G_acct_secret", json_object_new_string(tmp_char));
 
+
+
 	ret = do_uci_get(WIFI02_ATHENABLE, tmp_char);
 	if(ret != 0) {
 		cgi_err("get wlanif 5g athenable err\n");
@@ -14203,6 +14264,23 @@ int getspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 	}
 	json_object_object_add(obj, "WLANIF5G_spectrumwifi_ssid", json_object_new_string(tmp_char));
 
+
+	ret = do_uci_get(WIFI03_ATHENABLE, tmp_char);
+	if(ret != 0) {
+		cgi_err("get wlanif 5g athenable captive err\n");
+		strcpy(tmp_char, "");
+	}
+	json_object_object_add(obj, "WLANIF5G_enable_spectrumwifi_captive", json_object_new_int(atoi(tmp_char)));
+
+	ret = do_uci_get(WIFI03_SSID, tmp_char);
+	if(ret != 0) {
+		cgi_err("get wlanif 5g ssid captive err\n");
+		strcpy(tmp_char, "");
+	}
+	json_object_object_add(obj, "WLANIF5G_spectrumwifi_ssid_captive", json_object_new_string(tmp_char));
+
+
+
 	ret = do_uci_get(WIFI02_RADIUS_IPADDR, tmp_char);
 	if(ret != 0) {
 		cgi_err("get wlanif 5g radius ip err\n");
@@ -14296,8 +14374,21 @@ int setspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 
 	do_uci_set(WIFI02_NETWORK, "com");
 	do_uci_set(WIFI12_NETWORK, "com");
+#if 1
+        do_cmd("uci delete network.clear_com");
+        do_cmd("uci set network.clear_com=interface");
+        do_cmd("uci set network.clear_com.type='bridge'");
+        do_cmd("uci set network.clear_com.proto='static'");
 
+        do_cmd("uci delete network.clr_commtap");
+        do_cmd("uci set network.clr_commtap=interface");
+        do_cmd("uci set network.clr_commtap.type='bridge'");
 
+
+	//for clear
+	do_uci_set(WIFI03_NETWORK, "clear_com");
+	do_uci_set(WIFI13_NETWORK, "clear_com");
+#endif
 	do_cmd("uci delete network.veth");
 	do_cmd("uci set network.veth=interface");
 	do_cmd("uci set network.veth.proto='veth'");
@@ -14306,6 +14397,17 @@ int setspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 	do_cmd("uci set network.veth.network='com'");
 	do_cmd("uci set network.veth.peer_ifname='veth1'");
 	do_cmd("uci set network.veth.peer_network='commtap'");
+#if 1
+	//for clear
+	do_cmd("uci delete network.clear_veth");
+	do_cmd("uci set network.clear_veth=interface");
+	do_cmd("uci set network.clear_veth.proto='veth'");
+	do_cmd("uci set network.clear_veth.ifname='veth2'");
+/*uci set network.veth.vlanid='7'*/
+	do_cmd("uci set network.clear_veth.network='clear_com'");
+	do_cmd("uci set network.clear_veth.peer_ifname='veth3'");
+	do_cmd("uci set network.clear_veth.peer_network='clr_commtap'");
+#endif
 
 	/*setup the firewall*/
 	do_cmd("uci delete firewall.zone_sWiFi");
@@ -14329,7 +14431,13 @@ int setspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 	do_cmd("uci set network.tap=interface");
 	do_cmd("uci set network.tap.proto='gretap'");
 	do_cmd("uci set network.tap.network='commtap'");
-
+#if 1
+//for clear
+	do_cmd("uci delete network.clear_tap");
+	do_cmd("uci set network.clear_tap=interface");
+	do_cmd("uci set network.clear_tap.proto='gretap'");
+	do_cmd("uci set network.clear_tap.network='clr_commtap'");
+#endif
 
 	do_cmd("uci delete spectrumqos.spectrumdownstream");
 	do_cmd("uci set spectrumqos.spectrumdownstream=spectrum");
@@ -14393,7 +14501,7 @@ int setspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 		}
 
 		do_cmd("uci set network.tagv=interface");
-		sprintf(cmd_s, "uci set network.tagv.ifname='eth0.%d'", vlanid_i);
+		sprintf(cmd_s, "uci set network.tagv.ifname='eth3.%d'", vlanid_i);
 		do_cmd(cmd_s);
 		do_cmd("uci set network.tagv.proto='static'");
 //		do_cmd("uci set network.tagv.ipaddr='11.0.0.1'");
@@ -14414,6 +14522,8 @@ int setspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 		if(sub_obj) {
 			do_uci_set(SPEC_VLAN_IP, (char*)json_object_get_string(sub_obj));
 			do_uci_set(SPEC_VLAN_TAPIP, (char*)json_object_get_string(sub_obj));
+			do_uci_set(SPEC_VLAN_TAPIPCAPTIVE, (char*)json_object_get_string(sub_obj));
+
 		}
 
 		json_object_object_get_ex(i_obj, "vlan_ip6", &sub_obj);
@@ -14425,6 +14535,8 @@ int setspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 			ip6=strstr(ip6withMask,"/" );
 			*ip6='\0';
 			do_uci_set(SPEC_VLAN_TAPIP6, ip6withMask);
+			do_uci_set(SPEC_VLAN_TAPIP6CAPTIVE, ip6withMask);
+
 		}
 
 //		json_object_put(sub_obj);
@@ -14533,6 +14645,10 @@ int setspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 	}
 
 	if(tmp_i == 1) {
+
+                do_uci_set(SPEC_GRE_PROTO, "gretap");
+                do_uci_set(SPEC_GRE_CAPTIVE_PROTO, "gretap");
+
 		json_object_object_get_ex(i_obj, "peeraddr", &sub_obj);
 		if(sub_obj) {
 			do_cmd("uci set network.tap.proto='gretap'");
@@ -14546,9 +14662,26 @@ int setspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 		if(sub_obj) {
 			do_uci_set(SPEC_KA_SEC_ADDR , (char*)json_object_get_string(sub_obj));
 		}
+
+
+		json_object_object_get_ex(i_obj, "peeraddrcaptive", &sub_obj);
+		if(sub_obj) {
+			do_cmd("uci set network.tap.proto='gretap'");
+			do_uci_set(SPEC_PERR_IP_CAPTIVE, (char*)json_object_get_string(sub_obj));
+			do_uci_set(SPEC_KA_PRI_ADDR_CAPTIVE , (char*)json_object_get_string(sub_obj));
+
+		}
+
+		json_object_object_get_ex(i_obj, "peersecaddrcaptive", &sub_obj);
+		if(sub_obj) {
+			do_uci_set(SPEC_KA_SEC_ADDR_CAPTIVE , (char*)json_object_get_string(sub_obj));
+		}
 	}
 	else {
-		do_cmd("uci set network.tap.proto='grev6tap'");
+                do_uci_set(SPEC_GRE_PROTO6, "grev6tap");
+                do_uci_set(SPEC_GRE_CAPTIVE_PROTO6, "grev6tap");
+
+
 		json_object_object_get_ex(i_obj, "peeraddr6", &sub_obj);
 		if(sub_obj) {
 			do_uci_set(SPEC_PERR_IP6, (char*)json_object_get_string(sub_obj));
@@ -14561,6 +14694,20 @@ int setspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 		if(sub_obj) {
 			do_uci_set(SPEC_KA_SEC_ADDR , (char*)json_object_get_string(sub_obj));
 		}
+
+		json_object_object_get_ex(i_obj, "peeraddr6captive", &sub_obj);
+		if(sub_obj) {
+			do_uci_set(SPEC_PERR_IP6_CAPTIVE, (char*)json_object_get_string(sub_obj));
+			do_uci_set(SPEC_KA_PRI_ADDR_CAPTIVE , (char*)json_object_get_string(sub_obj));
+
+		}
+
+		json_object_object_get_ex(i_obj, "peersecaddr6captive", &sub_obj);
+		if(sub_obj) {
+			do_uci_set(SPEC_KA_SEC_ADDR_CAPTIVE , (char*)json_object_get_string(sub_obj));
+		}
+
+
 	}
 
 
@@ -14590,12 +14737,24 @@ int setspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 		sprintf(tmp_s, "%d", tmp_i);
 		do_uci_set(WIFI12_ATHENABLE, tmp_s);
 	}
+
+	json_object_object_get_ex(i_obj, "WLANIF2G_enable_spectrumwifi_captive", &sub_obj);
+	if(sub_obj) {
+		tmp_i = json_object_get_int(sub_obj);
+		sprintf(tmp_s, "%d", tmp_i);
+		do_uci_set(WIFI13_ATHENABLE, tmp_s);
+	}
 //	json_object_put(sub_obj);
 
 	json_object_object_get_ex(i_obj, "WLANIF2G_spectrumwifi_ssid", &sub_obj);
 	if(sub_obj) {
 		do_uci_set(WIFI12_SSID, (char*)json_object_get_string(sub_obj));
 	}
+
+	json_object_object_get_ex(i_obj, "WLANIF2G_spectrumwifi_ssid_captive", &sub_obj);
+	if(sub_obj) {
+		do_uci_set(WIFI13_SSID, (char*)json_object_get_string(sub_obj));
+	}
 //	json_object_put(sub_obj);
 
 	json_object_object_get_ex(i_obj, "WLANIF2G_auth_server", &sub_obj);
@@ -14646,6 +14805,22 @@ int setspectrumwifi(tcm_session *session, char *name, char *val, char *list)
 	if(sub_obj) {
 		do_uci_set(WIFI02_SSID, (char*)json_object_get_string(sub_obj));
 	}
+
+	json_object_object_get_ex(i_obj, "WLANIF5G_enable_spectrumwifi_captive", &sub_obj);
+	if(sub_obj) {
+		tmp_i = json_object_get_int(sub_obj);
+		sprintf(tmp_s, "%d", tmp_i);
+		do_uci_set(WIFI03_ATHENABLE, tmp_s);
+	}
+//	json_object_put(sub_obj);
+
+	json_object_object_get_ex(i_obj, "WLANIF5G_spectrumwifi_ssid_captive", &sub_obj);
+	if(sub_obj) {
+		do_uci_set(WIFI03_SSID, (char*)json_object_get_string(sub_obj));
+	}
+
+
+
 //	json_object_put(sub_obj);
 
 	json_object_object_get_ex(i_obj, "WLANIF5G_auth_server", &sub_obj);
diff --git a/base/software/common/qsdk/package/skysoft/skysoft_web_admin/cgi/include/uci_cfg.h b/base/software/common/qsdk/package/skysoft/skysoft_web_admin/cgi/include/uci_cfg.h
index 8cefe07..447f1bd 100644
--- a/base/software/common/qsdk/package/skysoft/skysoft_web_admin/cgi/include/uci_cfg.h
+++ b/base/software/common/qsdk/package/skysoft/skysoft_web_admin/cgi/include/uci_cfg.h
@@ -520,6 +520,72 @@
 #define WIFI02_WMMACM			"wireless.spectrumWiFi5g.wmm_acm"
 
 
+#define WIFI03_MAIN				"wireless.spectrumWiFi5g_clear"
+#define WIFI03_NETWORK		"wireless.spectrumWiFi5g_clear.network"
+#define WIFI03_ATHENABLE		"wireless.spectrumWiFi5g_clear.ath_enable"
+#define WIFI03_SSID				"wireless.spectrumWiFi5g_clear.ssid"
+#define WIFI03_MAXSTA			"wireless.spectrumWiFi5g_clear.maxsta"
+#define WIFI03_ISHIDDENSSID		"wireless.spectrumWiFi5g_clear.hidden"
+#define WIFI03_ISBGPROTECTION	"wireless.spectrumWiFi5g_clear.protmode"
+#define WIFI03_ENCRYPTION		"wireless.spectrumWiFi5g_clear.encryption"
+#define WIFI03_WEPID				"wireless.spectrumWiFi5g_clear.wepkeyid"
+#define WIFI03_WEPKEYID			"wireless.spectrumWiFi5g_clear.key"
+#define WIFI03_WEPKEY1			"wireless.spectrumWiFi5g_clear.key1"
+#define WIFI03_WEPKEY2			"wireless.spectrumWiFi5g_clear.key2"
+#define WIFI03_WEPKEY3			"wireless.spectrumWiFi5g_clear.key3"
+#define WIFI03_WEPKEY4			"wireless.spectrumWiFi5g_clear.key4"
+#define WIFI03_WPAPSK			"wireless.spectrumWiFi5g_clear.wpapsk"
+#define WIFI03_PSK				"wireless.spectrumWiFi5g_clear.key"
+#define WIFI03_REKEY				"wireless.spectrumWiFi5g_clear.wpa_group_rekey"
+#define WIFI03_PROTMF			"wireless.spectrumWiFi5g_clear.ieee80211w"
+#define WIFI03_WPS_ENABLE		"wireless.spectrumWiFi5g_clear.wps_enable"
+#define WIFI03_WPS_STATE			"wireless.spectrumWiFi5g_clear.wps_state"
+#define WIFI03_WPS_PIN			"wireless.spectrumWiFi5g_clear.wps_pin"
+#define WIFI03_WPS_PBCSTATUS		"wireless.spectrumWiFi5g_clear.wps_pbcstatus"
+#define WIFI03_NAWDS_MODE		"wireless.spectrumWiFi5g_clear.nawds_mode"
+#define WIFI03_NAWDS_MACLIST		"wireless.spectrumWiFi5g_clear.nawds_add_repeater"
+#define WIFI03_ISOLATE			"wireless.spectrumWiFi5g_clear.isolate"
+#define WIFI03_MCAST				"wireless.spectrumWiFi5g_clear.mcast_rate"
+#define WIFI03_MCAST_NUM			"wireless.spectrumWiFi5g_clear.mcast_num"
+#define WIFI03_PREAMBLE			"wireless.spectrumWiFi5g_clear.shortgi"
+#define WIFI03_RTS				"wireless.spectrumWiFi5g_clear.rts"
+#define WIFI03_FRAG				"wireless.spectrumWiFi5g_clear.frag"
+#define WIFI03_DTIM				"wireless.spectrumWiFi5g_clear.dtim_period"
+#define WIFI03_BINTVAL			"wireless.spectrumWiFi5g_clear.bintval"
+#define WIFI03_WMM				"wireless.spectrumWiFi5g_clear.wmm"
+#define WIFI03_WMMAPSD			"wireless.spectrumWiFi5g_clear.uapsd"
+#define WIFI03_AMPDU				"wireless.spectrumWiFi5g_clear.maxampdu"
+#define WIFI03_UBIBEAM			"wireless.spectrumWiFi5g_clear.implicitbf"
+#define WIFI03_VHTSUBFER			"wireless.spectrumWiFi5g_clear.vhtsubfer"
+#define WIFI03_VHTSUBFEE			"wireless.spectrumWiFi5g_clear.vhtsubfee"
+#define WIFI03_VHTMUBFER			"wireless.spectrumWiFi5g_clear.vhtmubfer"
+#define WIFI03_VHTMUBFEE			"wireless.spectrumWiFi5g_clear.vhtmubfee"
+#define WIFI03_IGMP_ENABLE		"wireless.spectrumWiFi5g_clear.mcastenhance"
+#define WIFI03_TXSTBC			"wireless.spectrumWiFi5g_clear.tx_stbc"
+#define WIFI03_RXSTBC			"wireless.spectrumWiFi5g_clear.rx_stbc"
+#define WIFI03_DISABLECOEXT		"wireless.spectrumWiFi5g_clear.disablecoext"
+#define WIFI03_WDSCAP			"wireless.spectrumWiFi5g_clear.wdscap"
+#define WIFI03_MACFILTER			"wireless.spectrumWiFi5g_clear.macfilter"
+#define WIFI03_MACACLLIST		"wireless.spectrumWiFi5g_clear.maclist"
+#define WIFI03_ACLENABLE			"wireless.spectrumWiFi5g_clear.aclenable"
+#define WIFI03_PERCENT			"wireless.spectrumWiFi5g_clear.percent"
+#define WIFI03_RRM				"wireless.spectrumWiFi5g_clear.rrm"
+#define WIFI03_IFNAME			"ath03"
+#define WIFI03_CLI_PERCENT		"wireless.spectrumWiFi5g_clear.cli_percent"
+#define WIFI03_PURE_AC			"wireless.spectrumWiFi5g_clear.pure11ac"
+#define WIFI03_ENABLE_11R		"wireless.spectrumWiFi5g_clear.ieee80211r"
+#define WIFI03_MOBILITY_DOMAIN	"wireless.spectrumWiFi5g_clear.mobility_domain"
+#define WIFI03_AP_MACADDR		"wireless.spectrumWiFi5g_clear.ap_macaddr"
+#define WIFI03_AP2_MACADDR		"wireless.spectrumWiFi5g_clear.ap2_macaddr"
+#define WIFI03_NASID				"wireless.spectrumWiFi5g_clear.nasid"
+#define WIFI03_R1KH_ID			"wireless.spectrumWiFi5g_clear.ap2_r1_key_holder"
+#define WIFI03_R1KH				"wireless.spectrumWiFi5g_clear.r1_key_holder"
+#define WIFI03_WMMACM			"wireless.spectrumWiFi5g_clear.wmm_acm"
+
+
+
+
+
 #define WIFI0_GUEST				"wireless.wla_guest"
 #define WIFI0_GUEST_SSID		"wireless.wla_guest.ssid"
 #define WIFI0_GUEST_ATHENABLE	"wireless.wla_guest.ath_enable"
@@ -738,6 +804,76 @@
 #define WIFI11_WMMACM			"wireless.wlg_hotspot.wmm_acm"
 
 
+#define WIFI13_MAIN				"wireless.spectrumWiFi_clear"
+#define WIFI13_NETWORK		"wireless.spectrumWiFi_clear.network"
+#define WIFI13_ATHENABLE		"wireless.spectrumWiFi_clear.ath_enable"
+#define WIFI13_SSID				"wireless.spectrumWiFi_clear.ssid"
+#define WIFI13_MAXSTA			"wireless.spectrumWiFi_clear.maxsta"
+#define WIFI13_ISHIDDENSSID		"wireless.spectrumWiFi_clear.hidden"
+#define WIFI13_ISBGPROTECTION	"wireless.spectrumWiFi_clear.protmode"
+#define WIFI13_ENCRYPTION		"wireless.spectrumWiFi_clear.encryption"
+#define WIFI13_WEPID				"wireless.spectrumWiFi_clear.wepkeyid"
+#define WIFI13_WEPKEYID			"wireless.spectrumWiFi_clear.key"
+#define WIFI13_WEPKEY1			"wireless.spectrumWiFi_clear.key1"
+#define WIFI13_WEPKEY2			"wireless.spectrumWiFi_clear.key2"
+#define WIFI13_WEPKEY3			"wireless.spectrumWiFi_clear.key3"
+#define WIFI13_WEPKEY4			"wireless.spectrumWiFi_clear.key4"
+#define WIFI13_WPAPSK			"wireless.spectrumWiFi_clear.wpapsk"
+#define WIFI13_PSK				"wireless.spectrumWiFi_clear.key"
+#define WIFI13_REKEY				"wireless.spectrumWiFi_clear.wpa_group_rekey"
+#define WIFI13_PROTMF			"wireless.spectrumWiFi_clear.ieee80211w"
+#define WIFI13_WPS_ENABLE		"wireless.spectrumWiFi_clear.wps_enable"
+#define WIFI13_WPS_STATE			"wireless.spectrumWiFi_clear.wps_state"
+#define WIFI13_WPS_PIN			"wireless.spectrumWiFi_clear.wps_pin"
+#define WIFI13_WPS_PBCSTATUS		"wireless.spectrumWiFi_clear.wps_pbcstatus"
+#define WIFI13_NAWDS_MODE		"wireless.spectrumWiFi_clear.nawds_mode"
+#define WIFI13_NAWDS_MACLIST		"wireless.spectrumWiFi_clear.nawds_add_repeater"
+#define WIFI13_ISOLATE			"wireless.spectrumWiFi_clear.isolate"
+#define WIFI13_MCAST				"wireless.spectrumWiFi_clear.mcast_rate"
+#define WIFI13_MCAST_NUM			"wireless.spectrumWiFi_clear.mcast_num"
+#define WIFI13_PREAMBLE			"wireless.spectrumWiFi_clear.shortgi"
+#define WIFI13_RTS				"wireless.spectrumWiFi_clear.rts"
+#define WIFI13_FRAG				"wireless.spectrumWiFi_clear.frag"
+#define WIFI13_DTIM				"wireless.spectrumWiFi_clear.dtim_period"
+#define WIFI13_BINTVAL			"wireless.spectrumWiFi_clear.bintval"
+#define WIFI13_WMM				"wireless.spectrumWiFi_clear.wmm"
+#define WIFI13_WMMAPSD			"wireless.spectrumWiFi_clear.uapsd"
+#define WIFI13_AMPDU				"wireless.spectrumWiFi_clear.maxampdu"
+#define WIFI13_QAM				"wireless.spectrumWiFi_clear.vht_11ng"
+#define WIFI13_UBIBEAM			"wireless.spectrumWiFi_clear.implicitbf"
+#define WIFI13_VHTSUBFER			"wireless.spectrumWiFi_clear.vhtsubfer"
+#define WIFI13_VHTSUBFEE			"wireless.spectrumWiFi_clear.vhtsubfee"
+#define WIFI13_VHTMUBFER			"wireless.spectrumWiFi_clear.vhtmubfer"
+#define WIFI13_VHTMUBFEE			"wireless.spectrumWiFi_clear.vhtmubfee"
+#define WIFI13_IGMP_ENABLE		"wireless.spectrumWiFi_clear.mcastenhance"
+#define WIFI13_TXSTBC			"wireless.spectrumWiFi_clear.tx_stbc"
+#define WIFI13_RXSTBC			"wireless.spectrumWiFi_clear.rx_stbc"
+#define WIFI13_DISABLECOEXT		"wireless.spectrumWiFi_clear.disablecoext"
+#define WIFI13_RADIUS_IPADDR		"wireless.spectrumWiFi_clear.auth_server"
+#define WIFI13_RADIUS_SERVERPORT "wireless.spectrumWiFi_clear.auth_port"
+#define WIFI13_RADIUS_SECRET		"wireless.spectrumWiFi_clear.auth_secret"
+#define WIFI13_ACCT_IPADDR		"wireless.spectrumWiFi_clear.acct_server"
+#define WIFI13_ACCT_SERVERPORT "wireless.spectrumWiFi_clear.acct_port"
+#define WIFI13_ACCT_SECRET		"wireless.spectrumWiFi_clear.acct_secret"
+#define WIFI13_WDSCAP			"wireless.spectrumWiFi_clear.wdscap"
+#define WIFI13_ACLENABLE			"wireless.spectrumWiFi_clear.aclenable"
+#define WIFI13_MACFILTER			"wireless.spectrumWiFi_clear.macfilter"
+#define WIFI13_MACACLLIST		"wireless.spectrumWiFi_clear.maclist"
+#define WIFI13_PERCENT			"wireless.spectrumWiFi_clear.percent"
+#define WIFI13_PURE_N			"wireless.spectrumWiFi_clear.puren"
+#define WIFI13_RRM				"wireless.spectrumWiFi_clear.rrm"
+#define WIFI13_IFNAME			"ath13"
+#define WIFI13_CLI_PERCENT		"wireless.spectrumWiFi_clear.cli_percent"
+#define WIFI13_ENABLE_11R		"wireless.spectrumWiFi_clear.ieee80211r"
+#define WIFI13_MOBILITY_DOMAIN	"wireless.spectrumWiFi_clear.mobility_domain"
+#define WIFI13_AP_MACADDR		"wireless.spectrumWiFi_clear.ap_macaddr"
+#define WIFI13_AP2_MACADDR		"wireless.spectrumWiFi_clear.ap2_macaddr"
+#define WIFI13_NASID				"wireless.spectrumWiFi_clear.nasid"
+#define WIFI13_R1KH_ID			"wireless.spectrumWiFi_clear.ap2_r1_key_holder"
+#define WIFI13_R1KH				"wireless.spectrumWiFi_clear.r1_key_holder"
+#define WIFI13_WMMACM			"wireless.spectrumWiFi_clear.wmm_acm"
+
+
 #define WIFI12_MAIN				"wireless.spectrumWiFi"
 #define WIFI12_NETWORK		"wireless.spectrumWiFi.network"
 #define WIFI12_ATHENABLE		"wireless.spectrumWiFi.ath_enable"
@@ -808,6 +944,10 @@
 #define WIFI12_WMMACM			"wireless.spectrumWiFi.wmm_acm"
 
 
+
+
+
+
 #define WIFI1_GUEST				"wireless.wlg_guest"
 #define WIFI1_GUEST_SSID		"wireless.wlg_guest.ssid"
 #define WIFI1_GUEST_ATHENABLE	"wireless.wlg_guest.ath_enable"
@@ -866,16 +1006,35 @@
 #define SPEC_VLAN_ID			"network.specvlan.vlan"
 
 #define SPEC_GRE_MODE			"network.tap.mode"
+
+#define SPEC_GRE_PROTO			"network.tap.proto"
+#define SPEC_GRE_PROTO6			"network.tap.proto"
+#define SPEC_GRE_CAPTIVE_PROTO			"network.clear_tap.proto"
+#define SPEC_GRE_CAPTIVE_PROTO6			"network.clear_tap.proto"
+
+
 #define SPEC_VLAN_TAPIP			"network.tap.ipaddr"
+#define SPEC_VLAN_TAPIPCAPTIVE			"network.clear_tap.ipaddr"
+
 #define SPEC_VLAN_TAPIP6			"network.tap.ip6addr"
+#define SPEC_VLAN_TAPIP6CAPTIVE			"network.clear_tap.ip6addr"
 
 #define SPEC_VLAN_ENABLE		"network.tap.enable_vlan"
 #define SPEC_PERR_IP			"network.tap.peeraddr"
 #define SPEC_PERR_IP6			"network.tap.peer6addr"
+#define SPEC_PERR_IP_CAPTIVE			"network.clear_tap.peeraddr"
+#define SPEC_PERR_IP6_CAPTIVE			"network.clear_tap.peer6addr"
+
 
 /* for keepalive*/
 #define SPEC_KA_PRI_ADDR			"network.tap.ka_pri_addr"
 #define SPEC_KA_SEC_ADDR			"network.tap.ka_sec_addr"
+
+#define SPEC_KA_PRI_ADDR_CAPTIVE			"network.clear_tap.ka_pri_addr"
+#define SPEC_KA_SEC_ADDR_CAPTIVE			"network.clear_tap.ka_sec_addr"
+
+
+
 #define SPEC_KA_INTRVL			"network.tap.ka_intrvl"
 #define SPEC_KA_THRLD			"network.tap.ka_thrld"
 #define SPEC_KA_PR_CHK_INTRVL			"network.tap.ka_pri_chk_intrvl"
diff --git a/base/software/common/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh b/base/software/common/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh
new file mode 100755
index 0000000..b45b671
--- /dev/null
+++ b/base/software/common/qsdk/package/skysoft/spectrum-wifi/files/clear_ssid_vlan.sh
@@ -0,0 +1,75 @@
+#!/bin/sh
+
+del_clear_ssid_vlan_config() {
+       
+        local VETH2_BR_NAME                                                    
+        local LOCAL_EP_NAME                                                                  
+        local PEER_EP_NAME                                                                   
+        local VLAN_ID                                                                        
+        local VETH3_BR_NAME                                                                  
+
+        VETH2_BR_NAME=`uci get network.clear_veth.network`                           
+        LOCAL_EP_NAME=`uci get network.clear_veth.ifname`                            
+        PEER_EP_NAME=`uci get network.clear_veth.peer_ifname`             
+        VLAN_ID=`uci get network.clear_veth.vlanid`                       
+        VETH3_BR_NAME=`uci get network.clear_veth.peer_network`           
+        
+	brctl delif br-$VETH2_BR_NAME $LOCAL_EP_NAME.$VLAN_ID                                          
+	vconfig rem $LOCAL_EP_NAME.$VLAN_ID
+        brctl delif br-$VETH3_BR_NAME $PEER_EP_NAME                                             
+	
+	ip link del $LOCAL_EP_NAME
+}
+
+restore_clear_ssid_vlan_config() {                                                          
+        local VETH2_BR_NAME                                                    
+        local LOCAL_EP_NAME                                                                  
+        local PEER_EP_NAME                                                                                                                                          
+        local VETH3_BR_NAME                                                                  
+
+        VETH2_BR_NAME=`uci get network.clear_veth.network`                           
+        LOCAL_EP_NAME=`uci get network.clear_veth.ifname`                            
+        PEER_EP_NAME=`uci get network.clear_veth.peer_ifname`             
+        VLAN_ID=`uci get network.clear_veth.vlanid`                       
+        VETH3_BR_NAME=`uci get network.clear_veth.peer_network`           
+
+                                                                                                                                             
+        ip link add $LOCAL_EP_NAME type veth peer name $PEER_EP_NAME                         
+        if [ "x" != ${VLAN_ID}x ]; then                                                             
+            vconfig add $LOCAL_EP_NAME $VLAN_ID                 
+       		brctl addif br-$VETH2_BR_NAME $LOCAL_EP_NAME.$VLAN_ID
+        	ifconfig $LOCAL_EP_NAME.$VLAN_ID up
+        else                                                                        
+			brctl addif br-$VETH2_BR_NAME $LOCAL_EP_NAME           
+        fi                                                                                   
+
+        brctl addif br-$VETH3_BR_NAME $PEER_EP_NAME                                             
+	ifconfig $LOCAL_EP_NAME up                                                           
+        ifconfig $PEER_EP_NAME up                                                            
+
+}
+
+
+
+case "$1" in                                                                                 
+        stop)                                                                               
+        	echo "clear_ssid vlan stopping"
+        	del_clear_ssid_vlan_config
+        	exit
+        ;;                                                                                   
+        start)
+        	echo "clear_ssid vlan starting"
+		restore_clear_ssid_vlan_config 
+		exit                                                       
+        ;;                                                                                   
+        reload)
+                echo "clear_ssid vlan reloading"   
+                del_clear_ssid_vlan_config
+                
+                #restart the hostapd
+       		#/etc/init.d/restart_spectrum_hostapd.sh reload
+                restore_clear_ssid_vlan_config                                                     
+                
+                exit         
+        ;;
+esac    
diff --git a/base/software/common/qsdk/qca/feeds/wlan_10_4/net/qca-wifi-10.4/files/qcawifi.sh b/base/software/common/qsdk/qca/feeds/wlan_10_4/net/qca-wifi-10.4/files/qcawifi.sh
index 92ce0c3..2e44894 100755
--- a/base/software/common/qsdk/qca/feeds/wlan_10_4/net/qca-wifi-10.4/files/qcawifi.sh
+++ b/base/software/common/qsdk/qca/feeds/wlan_10_4/net/qca-wifi-10.4/files/qcawifi.sh
@@ -2087,11 +2087,77 @@ config wifi-iface '${spectrumwifi}'
 	option ap_macaddr       "b4:ee:b4:e9:8f:ce"
 	option ap2_macaddr      "b4:ee:b4:e9:8f:cf"
 	option ap2_r1_key_holder  "b4:ee:b4:e9:8f:aa"
-	option nasid            "foo"
+	option nasid            "nas01"
+	option ft_over_ds	1
+	option chutil_enab	1
+
+config wifi-iface '${spectrumwifi}_clear'
+	option device		wifi$devidx
+	option network		clr_commtap
+	option mode		ap
+	option ath_enable	0
+	option ssid		'${spectrumwifi_ssid}_clear'
+	option hidden		0
+	option wps_enable	0
+	option wps_device_name	'$dev_name'
+	option wps_device_type	'6-${oui}04-1'
+	option wps_manufacturer	'$manufact'
+	option model_name	'$mod_name'
+	option model_number	'$mod_num'
+	option serial_number	'$ser_num'
+	option wps_config	'virtual_display virtual_push_button physical_push_button'
+	option wps_state	'2'
+	option wps_pbcstatus	idle
+	option wps_pin		'$pin'
+	option nawds_mode	0
+	option scanband 	0
+	option nawds_defcaps	0x0202
+	option wdscap		0x0102
+	option isolate		1
+	option shortgi		1
+	option rts		2347
+	option frag		2346
+	option dtim_period	3
+	option bintval		100
+	option wmm		1
+	option wmm_acm		0
+	option uapsd		1
+	option maxampdu		3
+	option vht_11ng		1
+	option implicitbf	0
+	option vhtsubfer	1
+	option vhtsubfee	1
+	option vhtmubfer	1
+	option vhtmubfee	0
+	option mcast_rate	54000
+	option mcast_num	0
+	option mcastenhance	2
+	option encryption	none
+	option wpa_group_rekey	3600
+	option disablecoext 	1
+	option tx_stbc		1
+	option rx_stbc		1
+	option macfilter	'allow'
+	option aclenable	'0'
+	option puren		0
+	option pure11ac		0
+	option maxsta		100
+	option rrm		1
+	option ieee80211w 	0
+	option ownip		'14.0.0.50'
+	option rsn_preauth	1
+	option lan_restricted	0
+	option ieee80211r       '0'
+	option mobility_domain  'a1b2'
+	option ap_macaddr       "b4:ee:b4:e9:8f:ce"
+	option ap2_macaddr      "b4:ee:b4:e9:8f:cf"
+	option ap2_r1_key_holder  "b4:ee:b4:e9:8f:aa"
+	option nasid            "nas02"
 	option ft_over_ds	1
 	option chutil_enab	1
 
 
+
 config wifi-iface '${name}_hotspot'
 	option device		wifi$devidx
 	option network		lan
-- 
1.9.1

